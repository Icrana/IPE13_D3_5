// Code for Pi

// file serial.items
String Arduino "Arduino [%s]" (arduino) {serial="/dev/ttyACM0"}
String Arduino_weight "Weight [%s]"
String Arduino_temperature "Temperature [%s]"
String Arduino_light "Light [%s]"

// file default.sitemap
sitemap default label="Home Automation Group 5"{
	Frame label="Arduino"{
		Text item=Arduino 
		Text item=Arduino_weight 
		Text item=Arduino_temperature
		Text item=Arduino_light
	}
	Frame label="Genuino"{
		Text item=Genuino 
		Text item=Genuino_knock
		Text item=Genuino_temperature
		Text item=Genuino_lightbar
		Text item=Genuino_button
	}
}

// file serial.rules
rule "Arduino"
	when
		Item Arduino received update
	then
		var String ArduinoUpdate = Arduino.state.toString.trim
		
		// weight
		var int weightStartsOn = ArduinoUpdate.indexOf("weight:") + "weight:".length
		var String weight = ArduinoUpdate.mid(weightStartsOn, ArduinoUpdate.indexOf('_')-weightStartsOn)
		
		Arduino_weight.postUpdate(weight)	
		
		// temperature
		var int temperatureStartsOn = ArduinoUpdate.indexOf("temperature:") + "temperature:".length
		var String temperature = ArduinoUpdate.mid(temperatureStartsOn, ArduinoUpdate.indexOf('_')-temperatureStartsOn)
		
		Arduino_temperature.postUpdate(temperature)
		
		// light
		var int lightStartsOn = ArduinoUpdate.indexOf("light:") + "light:".length
		var String light = ArduinoUpdate.mid(lightStartsOn, ArduinoUpdate.indexOf(';')-lightStartsOn)
		
		Arduino_light.postUpdate(light)
end

var String THINGSPEAK_URL="https://api.thingspeak.com/update?api_key=PAEA6JS2MXUR0U8D&field1=0"
//------------------------------------------------------------------------
//    Sendet Temperatur an ThingSpeak
//------------------------------------------------------------------------
rule "SendLightToThingSpeak"
        when
                Item Arduino_light received update
        then
                sendHttpGetRequest(THINGSPEAK_URL + "&field1=" + Arduino_light )
end


// changes in these files: /etc/init.d/openhab and /usr/share/openhab/bin/openhab.sh
// write into
-Dgnu.io.rxtx.SerialPorts=/dev/ttyACM0

// log datei
/var/log/openhab/events.log

